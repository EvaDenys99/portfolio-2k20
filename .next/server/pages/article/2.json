{"pageProps":{"article":{"id":"2","title":"Make your own Quadruped Robot","content":"######  Components\n\n*What I used to build Duke*\n\n*\tRaspberry Pi 4B – 4GB RAM\n*\tArduino Uno\n*\tArduino 16-channel PWM / Servo Shield\n*\tReely Micro-servo S-8246 Analoge servo\n*\tRaspberry Pi Camera V2 video module\n*\tAction powerbank\n*\tBatterij pack – 4AA\n*\tUsb cables\n*\tAction music box\n*\tAux cable\n*\tUSB microphone\n*\tWooden sticks like those from an ice cream\n*\tCardboard \n\n*For the chassis*\n\n*\tmePed v2 design\n*\t40ea – M3 x 10mm Screws\n*\t16ea – M3 x 12mm Screws\n*\t24ea – M3 Hex Nuts\n*\t32ea – M3 Nyloc Hex Nuts\n\n*other option is ordering the kit from http://www.meped.io/mepedv2*\n&nbsp\n#### Step 1: Making and assembling the hardware\n&nbsp\nFirst get you a dad like mine that is good in assembling hardware and can help you with this step. Then solder the Arduino 16-channel PWM together and test every input that exists on it.  \n&nbsp\nAfter that eat a lot of ice creams and keep the wooden sticks, just kidding ;) . You can go and buy these wooden sticks at your local drug store, with these sticks and a piece of cardboard you can make your first prototype. With this prototype, you can test the form of your robot. Like if you want it like a spider, a cat, etc. it is best that you test it first before you officially make a design out of wood. Then add the servos at the places you want on the prototype and test them Arduino 16-channel PWM / Servo Shield up top attached on top of the Arduino. \n&nbsp\n*Test it with this Arduino code:*\n&nbsp\n```#include <Wire.h>\n#include <Adafruit_PWMServoDriver.h>\n\n// called this way, it uses the default address 0x40\nAdafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver();\n// you can also call it with a different address you want\n//Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver(0x41);\n// you can also call it with a different address and I2C interface\n//Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver(0x40, Wire);\n\nvoid setup() {\n  Serial.begin(9600);\n  Serial.println(\"GPIO test!\");\n\n  pwm.begin();\n  pwm.setPWMFreq(1000);  // Set to whatever you like, we don't use it in this demo!\n\n  // if you want to really speed stuff up, you can go into 'fast 400khz I2C' mode\n  // some i2c devices dont like this so much so if you're sharing the bus, watch\n  // out for this!\n  Wire.setClock(400000);\n}\n\nvoid loop() {\n  // Drive each pin in a 'wave'\n  for (uint8_t pin=0; pin<16; pin++) {\n    pwm.setPWM(pin, 4096, 0);       // turns pin fully on\n    delay(100);\n    pwm.setPWM(pin, 0, 4096);       // turns pin fully off\n  }\n}\n```\n&nbsp\nMake sure that every Servo is calibrated the right way or else you will get some weird movements! (picture 2)\n&nbsp\nIt can happen that your prototype is not strong enough to hold his own weight and move like it should be moving, this happened with my prototype. What I did was just make my official design but that’s a decision up to you.\n&nbsp\nWhen you decide that you want to take your robot to the next level, you will need a laser cutter that cuts wood or order the mePed v2 kit. If you chose for the laser cutter you need to take the design of the mePed v2 (picture 3) and get the parts cut out, I used 3mm wood. After that you place everything in his place and assemble it together with the screws etc. \n&nbsp\nNow you have your base chassis with servos etc. if you want more levels for placing your micro controllers on, like me, please feel free to build further at the hardware.\n&nbsp\n*Tip: to make sure the robot does not slip or fall while doing his tricks please attach some soft-anti slip footers at the base of his paws.*\n&nbsp\n&nbsp\n#### Step 2: The software\n&nbsp\nI want to control my robot, Duke, with my phone. I want Duke to walk forward, backward, left, right but I also want it to do some awesome tricks like wave, take a bow, kick away a ball, etc. While doing all that I also want to have a view from what Duke is doing, basically a camera on his eye level. \n&nbsp\n###### Camera\nSo that’s what we start with, testing out the Raspberry Pi Camera V2 video module with the tutorial of Raspberry Pi himself. https://projects.raspberrypi.org/en/projects/getting-started-with-picamera \nThen to integrate this camera view into the website, which will be build with HTML5 etc., we follow the tutorial of this guy; https://www.youtube.com/watch?v=5QAHlZoPlgI . He tells us exactly what we need to do to simply integrate the video in our HTML and explains everything, even gives us the needs for how to tweak the settings of the camera.\n&nbsp\n###### Arduino movement control\nWith the open source robot mePed v2 there not only the chassis available but also the code,  http://www.meped.io/sites/default/files/2017-06/mePed_IR_Starter_Program_0.ino , this is written in C++. But between the mePed and Duke there are a lot of differences like the mePed is controlled by an IR Remote, they do not protect their Arduino with a Servo Shield but they use a Servo library instead, etc. \n&nbsp\nSo we need to rewrite their Arduino code to code that our Arduino + Servo Shield will understand. \n&nbsp\nIf you don’t have a lot of knowledge of Arduino code, it does not really matter, this is purely to understand the communication between Arduino and its components.\n&nbsp\nWe can’t use things like Servo.attach(PIN) and myServo.write(ANGLE) instead we need to set the PWM of the servo and then give it a pulse width to define the angle. After getting to know the code, understanding and modifying it to our application, you can start testing each movement on your own Duke.\n&nbsp\nOur code:\n&nbsp\n```#include <Wire.h>\n#include <Adafruit_PWMServoDriver.h>\n\n// called this way, it uses the default address 0x40\nAdafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver();\n\n#define MIN_PULSE_WIDTH     650\n#define MAX_PULSE_WIDTH     2350\n#define DEFAULT_PULSE_WIDTH     1500\n#define FREQUENCY     50\n\nvoid setup() {\n  //here you call a function like \"center_servos()\" and then your duke will do it\n}\n\nvoid center_servos(){\n  pwm.setPWM(13, 0, pulseWidth(90));\n  pwm.setPWM(15, 0, pulseWidth(90));\n  pwm.setPWM(3, 0, pulseWidth(90));\n  pwm.setPWM(1, 0, pulseWidth(90));\n  pwm.setPWM(2, 0, pulseWidth(90));\n  pwm.setPWM(0, 0, pulseWidth(90));\n  pwm.setPWM(12, 0, pulseWidth(90));\n  pwm.setPWM(14, 0, pulseWidth(90));\n  Serial.println(\"servos centered\");\n\n  int s11 = 90; //front left pivot servo\n  int s12 = 90; //front left lift servo\n  int s21 = 90; //back left pivot servo\n  int s22 = 90; //back left lift servo\n  int s31 = 90; //back right pivot servo\n  int s32 = 90; //back right lift servo\n  int s41 = 90; //front right pivot servo\n  int s42 = 90; //front right lift servo\n }\n\nvoid lean_left(){\n  pwm.setPWM(15, 0, pulseWidth(15));\n  pwm.setPWM(1, 0, pulseWidth(15));\n  pwm.setPWM(0, 0, pulseWidth(150));\n  pwm.setPWM(14, 0, pulseWidth(150));\n  Serial.println(\"lean_left done\");\n }\n \nvoid lean_right(){\n  pwm.setPWM(15, 0, pulseWidth(150));\n  pwm.setPWM(1, 0, pulseWidth(150));\n  pwm.setPWM(0, 0, pulseWidth(15));\n  pwm.setPWM(14, 0, pulseWidth(15));\n  Serial.println(\"lean_right done\");\n }\n\nvoid wave(){\n  center_servos();\n  pwm.setPWM(1, 0, pulseWidth(45));\n  pwm.setPWM(0, 0, pulseWidth(45));\n  delay(200);\n  pwm.setPWM(14, 0, pulseWidth(0));\n  delay(200);\n  pwm.setPWM(12, 0, pulseWidth(180));\n  delay(200);\n  pwm.setPWM(12, 0, pulseWidth(30));\n  delay(300);\n  pwm.setPWM(12, 0, pulseWidth(180));\n  delay(300);\n  pwm.setPWM(12, 0, pulseWidth(30));\n  delay(300);\n  pwm.setPWM(12, 0, pulseWidth(s41));\n  delay(300);\n  pwm.setPWM(12, 0, pulseWidth(s42));\n  center_servos();\n  Serial.println(\"wave done\");\n }\n\nvoid bow(){\n  center_servos();\n  delay(200);\n  pwm.setPWM(15, 0, pulseWidth(15));\n  pwm.setPWM(14, 0, pulseWidth(15));\n  delay(700);\n  pwm.setPWM(15, 0, pulseWidth(90));\n  pwm.setPWM(14, 0, pulseWidth(90));\n  delay(700);\n  Serial.println(\"bow done\");\n }\n\n\n void dance(){\n  center_servos();\n  delay(100);\n  lean_left();\n  delay(300);\n  lean_right();\n  delay(300);\n  lean_left();\n  delay(300);\n  lean_right();\n  delay(300);\n  lean_left();\n  delay(300);\n  lean_right();\n  delay(300);\n  lean_left();\n  delay(300);\n  lean_right();\n  delay(800);\n  center_servos();\n  delay(300);\n  bow();\n  center_servos();\n }\n\n \nint pulseWidth(int angle){\n  int pulse_wide, analog_value;\n  pulse_wide = map(angle, 0, 180, MIN_PULSE_WIDTH, MAX_PULSE_WIDTH);\n  analog_value = int(float(pulse_wide) / 1000000 * FREQUENCY * 4096);\n  Serial.println(analog_value);\n  return analog_value\n}\n```\n&nbsp\n###### Johnny-five movement control\n*Our control website is made out of HTML, CSS and JavaScript. Download the full code here https://github.com/EvaDenys99/PersonalProject . *\n&nbsp\nTo control our movements with our phone, we can’t use the Arduino code therefor we need to transform our code to a code that is understandable for JavaScript to use. \n&nbsp\nSo that is where Johnny-five comes in, Johnny-five is an JavaScript Robotics & IoT Platform. Easy to implement and to use. Just install Johnny-five by using, in our case, yarn add Johnny-five. And then on the server side require the package and make a new board instance. After doing that we will need to declare the controller, which is our Arduino Adafruit Servo shield, the PCA9685. Here is an example of Johnny-five self; http://johnny-five.io/examples/servo-PCA9685/ . Now we can declare our servo's and the pins they connect to.\n&nbsp\nCode examples: \n&nbsp\n```const five = require(\"johnny-five\");\nconst board = new five.Board({\n  repl: false\n});\nconst controller = \"PCA9685\";\n\n// Servo myServo1; // Front Left Pivot Servo\n  const FLPServo = new five.Servo({\n    controller,\n    pin: 13\n  });\n```\n&nbsp\nAfter turning the Arduino code into JavaScript code, we need to work on the communication as well. For this we are going to use Socket.io, we use this to trigger an event on our Arduino with our phone.\n&nbsp\nTo see the full code and inspect it go download it here; https://github.com/EvaDenys99/PersonalProject \n&nbsp\n###### Setting online on Raspberry Pi 4B\nI have never used a Raspberry Pi before in my life, so as an extra I wanted it to be used on my robot Duke. It is only necessary for the eye of Duke, our camera live feed. So I decided to also use my Raspberry Pi as a host for the control website. Using FileZilla to headless connect to the Raspberry Pi, we just drop our code there. And voila our code is online and working or is it not? Because we used yarn it does not start up from itself. So the solution is adding a file start.sh, here you just add the line “node index.js” and if you don’t want to manually start the camera every time you can add that line of code too. \n&nbsp\nNow our controls are online and working!\n&nbsp\n&nbsp\n####  Step 3: Simple Alexa abilities\n&nbsp\nSome functionalities I want our Duke to have are things like play music, set timer, etc. Everything that an Alexa basically does, so I found us a working tutorial; https://developer.amazon.com/en-US/docs/alexa/alexa-voice-service/register-a-product.html . Not everything from it works because I live in Belgium, now I install my Action music box at the top of Duke, like some sort of hat. Then I connect it with an aux cable to my Raspberry Pi, as microphone I use an USB-microphone. \n&nbsp\n&nbsp\n#### Step 4: Accessorize\n&nbsp\nMake your own Duke have a personality, make him pretty, etc. And enjoy your very own quadruped robot!\n&nbsp\n&nbsp","creationdate":"2019-12-20","headImage":{"url":"https://res.cloudinary.com/eva1999/image/upload/v1601475315/IMG_0016_0bd8c17f02.jpg","caption":""},"images":[{"url":"https://res.cloudinary.com/eva1999/image/upload/v1601470602/prototype_f5d3ec3bec.jpg","caption":"Prototype"},{"url":"https://res.cloudinary.com/eva1999/image/upload/v1603130440/servo_c9a0daebd6.png","caption":""},{"url":"https://res.cloudinary.com/eva1999/image/upload/v1603130338/me_Ped_19f80dfced.png","caption":""},{"url":"https://res.cloudinary.com/eva1999/image/upload/v1601470602/base_2e843d9189.jpg","caption":"Body basis"}],"videos":[{"url":"https://res.cloudinary.com/eva1999/video/upload/v1601470633/mov_e15cd71e0a.mp4","caption":""}],"categories":[{"id":"2","name":"Development"},{"id":"7","name":"Arduino Uno"},{"id":"8","name":"Raspberry Pi"}],"createdBy":"Eva Denys","description":"Build your own Duke with this tutorial. Control with your phone, Alexa abilities, etc... Make making a quadruped robot fun!"}},"__N_SSG":true}